import{z as L,y as b,m as f,o as r,c as d,b as t,a as C,k as E,t as s,F as g,r as S,u as a,a2 as R,j as Y,g as H,O as U,p as n,d as x,v as M,n as W,H as V,e as w,w as J}from"./app-eeb1ee89.js";import{u as K,_ as Q}from"./Modal-3fa6cd10.js";import{_ as X}from"./UserLayout-3d8e0176.js";import{_ as Z}from"./PageHeader-8760edd0.js";import{q as P}from"./vue3-apexcharts-862b2d6e.js";import{s as tt}from"./sharedComposable-624eb874.js";import{t as T}from"./toastComposable-88b306f2.js";import{h as $}from"./moment-a9aaa855.js";import"./dropdown-45d66330.js";import"./actionModalComposable-f268749a.js";const et={class:"container flex-grow p-4 sm:p-6"},st={class:"space-y-2"},at={class:"grid grid-cols-1 gap-6 lg:grid-cols-6"},ot={class:"card card-body col-span-1 lg:col-span-4"},nt={class:"chart-filter-area mb-4 mt-5 flex justify-between"},lt={class:"flex items-center gap-2"},it=t("i",{class:"bx bx-credit-card text-2xl"},null,-1),rt=["selected","value"],dt={id:"chart"},ct={class:"card card-body col-span-1 lg:col-span-2"},ut={class:"me-3 font-bold"},mt={class:"mt-12 flex items-center gap-1"},pt={class:"mt-2"},ht={class:"mb-3"},_t={class:"text-2xl font-bold"},vt={class:"text-md"},bt={class:"btn-label-wrap"},ft={class:"btn-label-inner"},gt={class:"mt-10"},xt={class:"flex gap-2"},yt={class:"font-bold"},Ct={class:"mb-1 mt-2 flex justify-between gap-3"},wt={class:"flex items-center gap-1"},kt=t("span",{class:"h-4 w-4 rounded-sm bg-green-400"},null,-1),At={class:"flex items-center gap-1"},St=t("div",{class:"h-4 w-4 rounded-sm bg-red-400"},null,-1),Mt={class:"flex items-center"},Ot={class:"relative w-full"},Dt=t("div",{class:"absolute left-0 h-4 w-full rounded bg-red-400"},null,-1),Bt={class:"mt-5 flex justify-between"},qt={class:"mb-3 text-center"},Ft={class:"fw-bold mt-2 text-left"},Ut={class:"my-8 flex gap-2 px-3"},Vt=["onClick"],Pt=t("i",{class:"bx bx-check absolute right-[-10px] top-[-10px] rounded-full bg-primary-600 p-1 text-white"},null,-1),Tt=[Pt],$t=["src"],jt=["id"],zt=["onSubmit"],It={class:"table-responsive"},Nt={class:"table-borderless table text-sm"},Gt={key:0,class:"border"},Lt={class:"border border-black p-2"},Et={class:"text-center"},Rt={key:0,class:"table-borderless mt-2 table"},Yt={class:"fw-500 text-sm"},Ht={class:"text-sm"},Wt={key:1,class:"form-group mt-2"},Jt={class:"fw-500 text-fs-sm my-2"},Kt={class:"form-group mt-1"},Qt={class:"fw-500 text-fs-sm my-2"},Xt={class:"form-group"},Zt={class:"fw-500 text-fs-sm my-2"},te=["disabled"],ee=H({layout:X}),me=Object.assign(ee,{__name:"Index",props:["buttons","request","credits","costChartData","activeChartFilterBtn","credit_fee","gateways","totalCostAmount","availableCreditAmount","spendCreditAmount"],setup(c){var F;const O=K(),{getState:j}=L(O),i=c,k=b(()=>{let o=i.availableCreditAmount+i.spendCreditAmount;return{available:Math.round(i.availableCreditAmount/o*100),spend:Math.round(i.spendCreditAmount/o*100)}}),z=["day","week","month","year"],D=b(()=>({series:[{name:"costs",data:i.costChartData.map(o=>o.credit)}],chartOptions:{colors:["#69ae84"],chart:{height:350,type:"bar",toolbar:{show:!1}},plotOptions:{bar:{horizontal:!1,columnWidth:"10px",endingShape:"rounded"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},yaxis:{show:!1,opposite:!0,labels:{formatter:function(o){return o.toFixed(0)}}},xaxis:{type:"string",categories:i.costChartData.map(o=>o.date)}}})),B=b(()=>({series:[i.availableCreditAmount,i.spendCreditAmount],chartOptions:{colors:["#4ade80","#f87171"],labels:["Available","Used"],chart:{width:250,type:"donut"},dataLabels:{enabled:!1},responsive:[{breakpoint:480,options:{chart:{width:200},legend:{show:!1}}}],legend:{show:!1}}})),{formatCurrency:h,authUser:I}=tt(),_=f(((F=i.gateways[0])==null?void 0:F.id)||0),v=f(null),q=f(i.credit_fee),y=b(()=>v.value/q.value),A=f(!1),u=f({image:null,comment:"",phone:I.value.phone}),p=b(()=>i.gateways.find(o=>o.id===_.value)),N=o=>{if(p.value.min_amount>y.value){T.danger(n("The minimum transaction amount is ")+h(p.value.min_amount));return}if(p.value.max_amount!=-1&&p.value.max_amount<y.value){T.danger(n("The maximum transaction amount is ")+h(p.value.max_amount));return}A.value=!0,U.post(route("credit.pay"),{gateway_id:o,total:y.value,credits:v.value,manualPayment:p.value.is_auto==0?u.value:null,phone:u.value.phone},{onFinish:()=>{v.value=0,A.value=!1}})},G=o=>{U.get(o)};return(o,l)=>(r(),d(g,null,[t("main",et,[C(Z,{title:"Credits",buttons:c.buttons},null,8,["buttons"]),t("div",st,[t("div",at,[t("div",ot,[t("div",nt,[t("h6",lt,[it,E(" Costs: "+s(c.totalCostAmount),1)]),t("select",{class:"select w-36 capitalize",onInput:l[0]||(l[0]=e=>G(e.target.value))},[(r(),d(g,null,S(z,e=>t("option",{key:e,selected:e==c.activeChartFilterBtn,value:o.route("user.credits.index",{scope:e})},s(e),9,rt)),64))],32)]),t("div",dt,[C(a(P),{type:"bar",height:"350",options:D.value.chartOptions,series:D.value.series},null,8,["options","series"])])]),t("div",ct,[t("span",ut,s(a(n)("Monthly Bill")),1),t("span",null,s(a($)().startOf("month").format("DD MMM"))+" - "+s(a($)().endOf("month").format("DD MMM")),1),t("div",mt,[C(a(P),{type:"donut",height:"200",width:"220",options:B.value.chartOptions,series:B.value.series},null,8,["options","series"]),t("div",pt,[t("div",ht,[t("div",_t,s(c.spendCreditAmount),1),t("div",vt,"/ "+s(c.availableCreditAmount)+" limit",1)]),t("button",{type:"button",onClick:l[1]||(l[1]=e=>a(O).open("addCredits")),class:"btn btn-sm btn-primary"},[t("span",bt,[t("span",ft,s(a(n)("Increase limit‍")),1)])])])]),t("div",gt,[t("div",xt,[t("div",yt,s(a(n)("Credit Usage")),1)]),t("div",Ct,[t("div",wt,[kt,t("span",null,s(a(n)("Available")),1)]),t("div",At,[St,t("span",null,s(a(n)("Used")),1)])]),t("div",Mt,[t("div",Ot,[Dt,t("div",{class:"absolute left-0 h-4 rounded bg-green-400",style:R({width:k.value.available+"%"})},null,4)])]),t("div",Bt,[t("span",null,s(k.value.available),1),t("span",null,s(k.value.spend),1)])])])])])]),C(Q,{state:a(j)("addCredits"),"header-state":!0,"header-title":"Buy Credits"},{default:Y(()=>[t("p",qt,s(q.value)+" "+s(a(n)("Credits"))+" = "+s(a(h)(1)),1),x(t("input",{class:"input",step:"5",type:"number","onUpdate:modelValue":l[2]||(l[2]=e=>v.value=e),placeholder:"Enter Credit amount"},null,512),[[M,v.value,void 0,{number:!0}]]),t("p",Ft,s(a(n)("Total:"))+" "+s(a(h)(y.value||0)),1),t("div",Ut,[(r(!0),d(g,null,S(c.gateways,e=>(r(),d("button",{key:e.id,class:W(["relative rounded-lg p-8",{"border bg-slate-50":_.value==e.id}]),onClick:m=>_.value=e.id},[x(t("div",null,Tt,512),[[V,_.value==e.id]]),t("img",{src:e.logo,class:"max-w-24"},null,8,$t)],10,Vt))),128))]),(r(!0),d(g,null,S(c.gateways,e=>x((r(),d("div",{key:e.id,class:"",id:"gateway-form"+e.id},[t("form",{method:"post",onSubmit:J(m=>N(e.id),["prevent"]),enctype:"multipart/form-data"},[t("div",It,[t("table",Nt,[e.charge!=0?(r(),d("tr",Gt,[t("td",Lt,s(a(n)("Gateway Charge: ")),1),t("td",Et,s(a(h)(e.charge)),1)])):w("",!0)]),e.comment!=null?(r(),d("table",Rt,[t("tr",null,[t("td",Yt,s(a(n)("Payment Instruction: ")),1)]),t("tr",null,[t("td",Ht,s(e.comment),1)])])):w("",!0),e.phone_required==1?(r(),d("div",Wt,[t("label",Jt,s(a(n)("Your phone number")),1),x(t("input",{type:"number",name:"phone",placeholder:"Your phone number",class:"input",required:"","onUpdate:modelValue":l[3]||(l[3]=m=>u.value.phone=m)},null,512),[[M,u.value.phone]])])):w("",!0),e.is_auto==0?(r(),d(g,{key:2},[t("div",Kt,[t("label",Qt,s(a(n)("Submit your payment proof")),1),t("input",{onInput:l[4]||(l[4]=m=>{u.value.image=m.target.files[0]}),type:"file",name:"image",class:"input",required:"",accept:"image/*"},null,32)]),t("div",Xt,[t("label",Zt,s(a(n)("Comment")),1),x(t("textarea",{"onUpdate:modelValue":l[5]||(l[5]=m=>u.value.comment=m),class:"input",required:"",name:"comment",placeholder:"comment",maxlength:"500"},null,512),[[M,u.value.comment]])])],64)):w("",!0)]),t("button",{disabled:A.value,type:"submit",class:"btn btn-primary mt-4 w-full py-2 text-lg"},s(a(n)("Pay Now")),9,te)],40,zt)],8,jt)),[[V,_.value===e.id]])),128))]),_:1},8,["state"])],64))}});export{me as default};
